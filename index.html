<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Experto Legal Laboral</title>

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            display: flex;
            height: 100vh;
            background: #f4f4f4;
        }

        .sidebar {
            width: 240px;
            background: #2c3e50;
            color: white;
        }

        .sidebar h2 {
            text-align: center;
            padding: 15px;
            background: #1a252f;
            margin: 0;
        }

        .sidebar button {
            width: 100%;
            background: none;
            border: none;
            color: white;
            padding: 15px;
            text-align: left;
            cursor: pointer;
        }

        .sidebar button:hover {
            background: #34495e;
        }

        .main {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 600px;
            box-shadow: 0 0 10px rgba(0, 0, 0, .2);
        }

        select,
        input,
        button {
            width: 100%;
            padding: 8px;
            margin-top: 10px;
        }

        button.primary {
            background: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        .result img {
            width: 100%;
        }
    </style>
</head>

<body>

    <!-- SIDEBAR -->
    <div class="sidebar">
        <h2>âš–ï¸ LegalApp</h2>
        <button onclick="showView('expertView')">ğŸ§  DiagnÃ³stico</button>
        <button onclick="showView('profileView')">ğŸ‘¤ Perfil</button>
        <button onclick="showView('loginView')">ğŸ” Login</button>
    </div>

    <!-- MAIN -->
    <div class="main">

        <!-- SISTEMA EXPERTO -->
        <div id="expertView" class="view active">
            <h2>ğŸ§  DiagnÃ³stico Legal Laboral</h2>

            <div class="card">
                <label>CategorÃ­a:</label>
                <select id="categorySelect" onchange="loadCases()">
                    <option value="">Seleccione</option>
                    <option value="despido">Despido</option>
                    <option value="salario">Salarios</option>
                    <option value="jornada">Jornada laboral</option>
                    <option value="prestaciones">Prestaciones</option>
                    <option value="acoso">Acoso / DiscriminaciÃ³n</option>
                    <option value="contrato">Contrato</option>
                    <option value="riesgos">Riesgos de trabajo</option>
                    <option value="seguridad">Seguridad e higiene</option>
                    <option value="licencias">Licencias legales</option>
                </select>

                <label>Caso:</label>
                <select id="caseSelect" onchange="loadForm()">
                    <option value="">Seleccione un caso</option>
                </select>

                <div id="dynamicForm"></div>

                <button class="primary" onclick="diagnosticar()">Diagnosticar</button>

                <div class="result" id="resultArea"></div>
            </div>
        </div>

        <!-- PERFIL -->
        <div id="profileView" class="view">
            <h2>ğŸ‘¤ Perfil - Historial</h2>
            <div id="historyArea"></div>
        </div>

        <!-- LOGIN -->
        <div id="loginView" class="view">
            <h2>ğŸ” Iniciar SesiÃ³n</h2>
            <input id="userInput" placeholder="Usuario">
            <button class="primary" onclick="login()">Entrar</button>
        </div>

    </div>

    <script>
        /* ===== NAVEGACIÃ“N ===== */
        function showView(id) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        /* ===== LOGIN ===== */
        let currentUser = localStorage.getItem("currentUser");

        function login() {
            const u = document.getElementById("userInput").value.trim();
            if (!u) return alert("Ingrese un usuario");
            currentUser = u;
            localStorage.setItem("currentUser", u);
            loadHistory();
            showView("profileView");
        }

        /* ===== BASE DE CONOCIMIENTO ===== */
        const knowledgeBase = {
            despido: {
                "Despido injustificado": [
                    "Â¿Fue despedido sin aviso de rescisiÃ³n?",
                    "Â¿No se comprobÃ³ falta grave?"
                ],
                "Renuncia forzada": [
                    "Â¿Fue presionado para renunciar?",
                    "Â¿FirmÃ³ documentos bajo presiÃ³n?"
                ]
            },
            salario: {
                "Falta de pago de salario": [
                    "Â¿Recibe su salario incompleto?",
                    "Â¿Hay retrasos frecuentes en el pago?"
                ]
            },
            jornada: {
                "Horas extra no pagadas": [
                    "Â¿Trabaja mÃ¡s de 8 horas?",
                    "Â¿No le pagan horas extra?"
                ]
            },
            prestaciones: {
                "Incumplimiento de prestaciones": [
                    "Â¿No recibe aguinaldo?",
                    "Â¿No tiene vacaciones?",
                    "Â¿No estÃ¡ afiliado al IMSS?"
                ]
            },
            acoso: {
                "Acoso laboral": [
                    "Â¿Sufre humillaciones constantes?",
                    "Â¿Recibe presiÃ³n psicolÃ³gica?"
                ],
                "DiscriminaciÃ³n laboral": [
                    "Â¿Ha sido discriminado por algÃºn motivo?"
                ]
            },
            contrato: {
                "Contrato irregular": [
                    "Â¿No tiene contrato escrito?",
                    "Â¿EstÃ¡ contratado por honorarios?"
                ]
            },
            riesgos: {
                "Riesgo de trabajo": [
                    "Â¿SufriÃ³ accidente laboral?",
                    "Â¿El patrÃ³n se negÃ³ a reconocerlo?"
                ]
            },
            seguridad: {
                "Falta de seguridad e higiene": [
                    "Â¿No cuenta con equipo de protecciÃ³n?",
                    "Â¿Las instalaciones son peligrosas?"
                ]
            },
            licencias: {
                "Licencias legales negadas": [
                    "Â¿Le negaron licencia mÃ©dica o parental?"
                ]
            }
        };

        let answers = [];

        /* ===== CARGAR CASOS ===== */
        function loadCases() {
            const category = document.getElementById("categorySelect").value;
            const caseSelect = document.getElementById("caseSelect");
            caseSelect.innerHTML = '<option value="">Seleccione un caso</option>';
            document.getElementById("dynamicForm").innerHTML = "";

            if (!knowledgeBase[category]) return;

            Object.keys(knowledgeBase[category]).forEach(c => {
                caseSelect.innerHTML += `<option value="${c}">${c}</option>`;
            });
        }

        /* ===== FORMULARIO DINÃMICO ===== */
        function loadForm() {
            answers = [];
            const category = document.getElementById("categorySelect").value;
            const selectedCase = document.getElementById("caseSelect").value;
            const formDiv = document.getElementById("dynamicForm");
            formDiv.innerHTML = "";

            if (!selectedCase) return;

            knowledgeBase[category][selectedCase].forEach((q, i) => {
                formDiv.innerHTML += `
            <label>${q}</label>
            <select onchange="answers[${i}] = this.value">
                <option value="">Seleccione</option>
                <option value="si">SÃ­</option>
                <option value="no">No</option>
            </select>
        `;
            });
        }

        /* ===== MOTOR DE INFERENCIAS ===== */
        function diagnosticar() {
            if (!currentUser) return alert("Debe iniciar sesiÃ³n");

            const positivos = answers.filter(a => a === "si").length;
            const selectedCase = document.getElementById("caseSelect").value;

            let texto = positivos > 0
                ? `âš–ï¸ DiagnÃ³stico: Posible ${selectedCase}`
                : "âœ… No se detecta conflicto legal relevante";

            generarImagen(texto);
        }

        /* ===== GENERAR IMAGEN ===== */
        function generarImagen(texto) {
            const canvas = document.createElement("canvas");
            canvas.width = 500;
            canvas.height = 200;
            const ctx = canvas.getContext("2d");

            ctx.fillStyle = "#fff";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#000";
            ctx.font = "18px Arial";
            ctx.fillText("Resultado del DiagnÃ³stico Legal", 80, 40);
            ctx.font = "16px Arial";
            ctx.fillText(texto, 20, 100);

            guardarHistorial(canvas.toDataURL(), texto);
        }

        /* ===== HISTORIAL ===== */
        function guardarHistorial(img, texto) {
            let history = JSON.parse(localStorage.getItem(currentUser)) || [];
            history.push({ fecha: new Date().toLocaleString(), img, texto });
            localStorage.setItem(currentUser, JSON.stringify(history));
            loadHistory();
            showView("profileView");
        }

        function loadHistory() {
            const div = document.getElementById("historyArea");
            div.innerHTML = "";
            (JSON.parse(localStorage.getItem(currentUser)) || []).forEach(h => {
                div.innerHTML += `
            <div class="card">
                <b>${h.fecha}</b><br>
                <img src="${h.img}">
                <p>${h.texto}</p>
            </div><br>
        `;
            });
        }
    </script>

</body>

</html>